<div class="documents-list">
  <%= f.label :documents, t("documents.form.title") %>
  <p class="help-text"><%= documentables_note(documentable) %></p>

  <% css_id = local_assigns[:parent_id] ? "nested-documents-#{local_assigns[:parent_id]}" : "nested-documents" %>
  <% link_id = local_assigns[:parent_id] ? "new_document_link-#{local_assigns[:parent_id]}" : "new_document_link" %>
  <div id="<%= css_id %>" data-max-documents-allowed="<%= documentable.class.max_documents_allowed%>">
    <%= f.fields_for :documents do |documents_builder| %>
      <%= render 'documents/document_fields', f: documents_builder %>
    <% end %>
  </div>

  <%= link_to_add_association t('documents.form.add_new_document'), f, :documents,
                              partial: "documents/document_fields",
                              id: link_id,
                              class: "new-document-link button hollow  #{"hide" if documentable.documents.count >= documentable.class.max_documents_allowed}",
                              data: {
                                association_insertion_node: "##{css_id}",
                                association_insertion_method: "append"
                              } %>

    <% if documentable.class.max_documents_allowed > 1 %>
      <div id="max-documents-notice" class="max-documents-notice callout warning text-center <%= "hide" unless max_documents_allowed?(documentable) %>">
        <%= t "documents.max_documents_allowed_reached_html" %>
      </div>
    <% end %>
</div>
